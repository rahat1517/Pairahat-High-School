<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin | Pairahat Secondary School</title>
  <link rel="stylesheet" href="style.css" />

  <link rel="stylesheet" href="ticker.css">
    <link rel="stylesheet" href="footer.css">
    <link rel="stylesheet" href="token.css">
    <link rel="stylesheet" href="header.css">
</head>
<body>

<header>
  <div class="container">
    <h1>Pairahat Secondary School</h1>
    <p>Admin Panel - Result Management</p>
  </div>
</header>

<nav>
  <div class="container">
    <a href="index.html">Home</a>
    <a href="result.html">Result</a>
    <a href="admin.html" class="secondary-btn">Admin</a>
  </div>
</nav>

<main>
  <section class="section">
    <div class="container card">

      <h2>Admin Login</h2>

      <div id="loginBox">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="email" placeholder="Admin email" />
        </div>

        <div class="form-group">
          <label>Password</label>
          <input type="password" id="password" placeholder="Admin password" />
        </div>

        <div class="home-actions">
          <button class="login-btn" id="loginBtn" style="max-width:240px;">Login</button>
          <button class="secondary-btn" id="logoutBtn" style="display:none;">Logout</button>
        </div>

        <p id="authMsg" style="margin-top:10px;font-weight:800;"></p>
      </div>

      <hr style="margin:18px 0; opacity:.2;">

      <div id="adminPanel" style="display:none;">
        <h2>Add / Update Result</h2>

        <div class="form-grid">
          <div class="form-group">
            <label>Class</label>
            <select id="cls">
              <option value="">Select</option>
              <option value="6">Class 6</option>
              <option value="7">Class 7</option>
              <option value="8">Class 8</option>
              <option value="9">Class 9</option>
              <option value="10">Class 10</option>
            </select>
          </div>

          <div class="form-group">
            <label>Roll</label>
            <input type="text" id="roll" placeholder="e.g. 105" />
          </div>

          <div class="form-group">
            <label>Student Name</label>
            <input type="text" id="name" placeholder="e.g. Rahim" />
          </div>

          <div class="form-group">
            <label>GPA</label>
            <input type="text" id="gpa" placeholder="e.g. 5.00" />
          </div>
        </div>

        <div class="home-actions">
          <button class="login-btn" id="saveBtn" style="max-width:240px;">Save</button>
          <button class="secondary-btn" id="deleteBtn">Delete</button>
        </div>

        <p id="msg" style="margin-top:10px;font-weight:800;"></p>
      </div>

    </div>
  </section>
</main>

<footer>
  <div class="container">
    <p>¬© 2026 Pairahat Secondary School</p>
  </div>
</footer>

<script type="module">
  import { auth, db } from "./firebase.js";
  import {
    signInWithEmailAndPassword,
    onAuthStateChanged,
    signOut
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
  import {
    doc, setDoc, getDoc, deleteDoc, serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

  const email = document.getElementById("email");
  const password = document.getElementById("password");
  const loginBtn = document.getElementById("loginBtn");
  const logoutBtn = document.getElementById("logoutBtn");
  const authMsg = document.getElementById("authMsg");

  const adminPanel = document.getElementById("adminPanel");
  const msg = document.getElementById("msg");

  const cls = document.getElementById("cls");
  const roll = document.getElementById("roll");
  const name = document.getElementById("name");
  const gpa = document.getElementById("gpa");
  const saveBtn = document.getElementById("saveBtn");
  const deleteBtn = document.getElementById("deleteBtn");

  function setAuthMsg(text, ok=true){
    authMsg.style.color = ok ? "green" : "red";
    authMsg.textContent = text;
  }

  function setMsg(text, ok=true){
    msg.style.color = ok ? "green" : "red";
    msg.textContent = text;
  }

  loginBtn.addEventListener("click", async () => {
    try{
      await signInWithEmailAndPassword(auth, email.value, password.value);
      setAuthMsg("‚úÖ Logged in!");
    }catch(e){
      setAuthMsg("‚ùå Login failed! Check email/password.", false);
    }
  });

  logoutBtn.addEventListener("click", async () => {
    await signOut(auth);
    setAuthMsg("Logged out.");
  });

  onAuthStateChanged(auth, (user) => {
    if(user){
      adminPanel.style.display = "block";
      logoutBtn.style.display = "inline-block";
      loginBtn.style.display = "none";
      setAuthMsg(` Admin: ${user.email}`);
    } else {
      adminPanel.style.display = "none";
      logoutBtn.style.display = "none";
      loginBtn.style.display = "inline-block";
    }
  });

  saveBtn.addEventListener("click", async () => {
    const c = cls.value.trim();
    const r = roll.value.trim();
    const n = name.value.trim();
    const g = gpa.value.trim();

    if(!c || !r || !n || !g){
      setMsg("‚ùå Please fill all fields.", false);
      return;
    }

    const id = `${c}_${r}`;
    await setDoc(doc(db, "results", id), {
      class: c, roll: r, name: n, gpa: g,
      updatedAt: serverTimestamp()
    }, { merge: true });

    setMsg("‚úÖ Saved/Updated successfully!");
  });

  deleteBtn.addEventListener("click", async () => {
    const c = cls.value.trim();
    const r = roll.value.trim();
    if(!c || !r){
      setMsg(" Enter Class and Roll to delete.", false);
      return;
    }
    const id = `${c}_${r}`;
    const ref = doc(db, "results", id);
    const snap = await getDoc(ref);
    if(!snap.exists()){
      setMsg(" Result not found.", false);
      return;
    }
    await deleteDoc(ref);
    setMsg("üóëÔ∏è Deleted successfully!");
  });
</script>

</body>
</html>
